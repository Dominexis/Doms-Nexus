# Create scoreboard objectives

scoreboard objectives add nexus.value dummy
scoreboard objectives add nexus.id dummy
scoreboard objectives add nexus.entity_id dummy
scoreboard objectives add nexus.ticks dummy
scoreboard objectives add nexus.modified dummy



scoreboard objectives add nexus.tick_dist dummy
scoreboard objectives add nexus.tick_bool dummy

scoreboard objectives add nexus.id_bool dummy
scoreboard objectives add nexus.id_range dummy
scoreboard objectives add nexus.vehicle_id_bool dummy
scoreboard objectives add nexus.air_toggle_bool dummy
scoreboard objectives add nexus.damage_sensor_bool dummy



scoreboard objectives add nexus.health dummy
scoreboard objectives add nexus.size dummy
scoreboard objectives add nexus.mass dummy
scoreboard objectives add nexus.target dummy
scoreboard objectives add nexus.vehicle dummy
scoreboard objectives add nexus.seat dummy
scoreboard objectives add nexus.nbt_ticks dummy
scoreboard objectives add nexus.nbt_delay dummy
scoreboard objectives add nexus.priority dummy
scoreboard objectives add nexus.mot_ticks dummy
scoreboard objectives add nexus.gamemode dummy
scoreboard objectives add nexus.invulnerable dummy
scoreboard objectives add nexus.stored_invulnerable dummy
scoreboard objectives add nexus.stop_launch_sound dummy
scoreboard objectives add nexus.use_shield dummy
scoreboard objectives add nexus.attack_cooldown dummy

scoreboard objectives add nexus.mode dummy
scoreboard objectives add nexus.animation dummy
scoreboard objectives add nexus.velocity dummy

scoreboard objectives add nexus.damage dummy
scoreboard objectives add nexus.heal dummy
scoreboard objectives add nexus.source dummy
scoreboard objectives add nexus.hp_time dummy
scoreboard objectives add nexus.hp_offset dummy
scoreboard objectives add nexus.resistance dummy
scoreboard objectives add nexus.protection dummy

scoreboard objectives add nexus.abs_amount dummy
scoreboard objectives add nexus.abs_level dummy
scoreboard objectives add nexus.abs_timer dummy



scoreboard objectives add nexus.use_item minecraft.used:minecraft.warped_fungus_on_a_stick
scoreboard objectives add nexus.milk minecraft.used:minecraft.milk_bucket
scoreboard objectives add nexus.death deathCount



scoreboard objectives add nexus.x dummy
scoreboard objectives add nexus.y dummy
scoreboard objectives add nexus.z dummy

scoreboard objectives add nexus.mot_x dummy
scoreboard objectives add nexus.mot_y dummy
scoreboard objectives add nexus.mot_z dummy

scoreboard objectives add nexus.poi_x dummy
scoreboard objectives add nexus.poi_y dummy
scoreboard objectives add nexus.poi_z dummy

scoreboard objectives add nexus.mot_poi_x dummy
scoreboard objectives add nexus.mot_poi_y dummy
scoreboard objectives add nexus.mot_poi_z dummy

scoreboard objectives add nexus.prev_x dummy
scoreboard objectives add nexus.prev_y dummy
scoreboard objectives add nexus.prev_z dummy

scoreboard objectives add nexus.prev_mot_x dummy
scoreboard objectives add nexus.prev_mot_y dummy
scoreboard objectives add nexus.prev_mot_z dummy



scoreboard objectives add nexus.yaw dummy
scoreboard objectives add nexus.pitch dummy
scoreboard objectives add nexus.roll dummy

scoreboard objectives add nexus.mot_yaw dummy
scoreboard objectives add nexus.mot_pitch dummy
scoreboard objectives add nexus.mot_roll dummy

scoreboard objectives add nexus.poi_yaw dummy
scoreboard objectives add nexus.poi_pitch dummy
scoreboard objectives add nexus.poi_roll dummy

scoreboard objectives add nexus.mot_poi_yaw dummy
scoreboard objectives add nexus.mot_poi_pitch dummy
scoreboard objectives add nexus.mot_poi_roll dummy

scoreboard objectives add nexus.prev_yaw dummy
scoreboard objectives add nexus.prev_pitch dummy
scoreboard objectives add nexus.prev_roll dummy

scoreboard objectives add nexus.prev_mot_yaw dummy
scoreboard objectives add nexus.prev_mot_pitch dummy
scoreboard objectives add nexus.prev_mot_roll dummy



scoreboard objectives add nexus.collide dummy
scoreboard objectives add nexus.collide_x dummy
scoreboard objectives add nexus.collide_y dummy
scoreboard objectives add nexus.collide_z dummy

scoreboard objectives add nexus.head_x dummy
scoreboard objectives add nexus.head_y dummy
scoreboard objectives add nexus.head_z dummy

scoreboard objectives add nexus.ang_vel_x dummy
scoreboard objectives add nexus.ang_vel_y dummy
scoreboard objectives add nexus.ang_vel_z dummy



scoreboard objectives add nexus.matrix_x_x dummy
scoreboard objectives add nexus.matrix_x_y dummy
scoreboard objectives add nexus.matrix_x_z dummy
scoreboard objectives add nexus.matrix_y_x dummy
scoreboard objectives add nexus.matrix_y_y dummy
scoreboard objectives add nexus.matrix_y_z dummy
scoreboard objectives add nexus.matrix_z_x dummy
scoreboard objectives add nexus.matrix_z_y dummy
scoreboard objectives add nexus.matrix_z_z dummy

scoreboard objectives add nexus.vector_x_x dummy
scoreboard objectives add nexus.vector_x_y dummy
scoreboard objectives add nexus.vector_x_z dummy
scoreboard objectives add nexus.vector_y_x dummy
scoreboard objectives add nexus.vector_y_y dummy
scoreboard objectives add nexus.vector_y_z dummy
scoreboard objectives add nexus.vector_z_x dummy
scoreboard objectives add nexus.vector_z_y dummy
scoreboard objectives add nexus.vector_z_z dummy

scoreboard objectives add nexus.vector_x dummy
scoreboard objectives add nexus.vector_y dummy
scoreboard objectives add nexus.vector_z dummy

scoreboard objectives add nexus.axis_x dummy
scoreboard objectives add nexus.axis_y dummy
scoreboard objectives add nexus.axis_z dummy

scoreboard objectives add nexus.quaternion_r dummy
scoreboard objectives add nexus.quaternion_i dummy
scoreboard objectives add nexus.quaternion_j dummy
scoreboard objectives add nexus.quaternion_k dummy



scoreboard objectives add nexus.wasd_w dummy
scoreboard objectives add nexus.wasd_a dummy
scoreboard objectives add nexus.wasd_s dummy
scoreboard objectives add nexus.wasd_d dummy



scoreboard objectives add nexus.uuid_0 dummy
scoreboard objectives add nexus.uuid_1 dummy
scoreboard objectives add nexus.uuid_2 dummy
scoreboard objectives add nexus.uuid_3 dummy
scoreboard objectives add nexus.owner_uuid_0 dummy
scoreboard objectives add nexus.owner_uuid_1 dummy
scoreboard objectives add nexus.owner_uuid_2 dummy
scoreboard objectives add nexus.owner_uuid_3 dummy



scoreboard objectives add nexus.event_phe dummy
scoreboard objectives add nexus.event_pke dummy
scoreboard objectives add nexus.event_ehp dummy
scoreboard objectives add nexus.event_ekp dummy
scoreboard objectives add nexus.event_piwe dummy



scoreboard objectives add nexus.pathfinder dummy
scoreboard objectives add nexus.threshold dummy
scoreboard objectives add nexus.threshold_1 dummy
scoreboard objectives add nexus.threshold_2 dummy



scoreboard objectives add nexus.anim_time_00 dummy
scoreboard objectives add nexus.anim_time_01 dummy
scoreboard objectives add nexus.anim_time_02 dummy
scoreboard objectives add nexus.anim_time_03 dummy
scoreboard objectives add nexus.anim_time_04 dummy
scoreboard objectives add nexus.anim_time_05 dummy
scoreboard objectives add nexus.anim_time_06 dummy
scoreboard objectives add nexus.anim_time_07 dummy
scoreboard objectives add nexus.anim_time_08 dummy
scoreboard objectives add nexus.anim_time_09 dummy
scoreboard objectives add nexus.anim_time_10 dummy
scoreboard objectives add nexus.anim_time_11 dummy
scoreboard objectives add nexus.anim_time_12 dummy
scoreboard objectives add nexus.anim_time_13 dummy
scoreboard objectives add nexus.anim_time_14 dummy
scoreboard objectives add nexus.anim_time_15 dummy
scoreboard objectives add nexus.anim_time_16 dummy
scoreboard objectives add nexus.anim_time_17 dummy
scoreboard objectives add nexus.anim_time_18 dummy
scoreboard objectives add nexus.anim_time_19 dummy

scoreboard objectives add nexus.anim_infl_00 dummy
scoreboard objectives add nexus.anim_infl_01 dummy
scoreboard objectives add nexus.anim_infl_02 dummy
scoreboard objectives add nexus.anim_infl_03 dummy
scoreboard objectives add nexus.anim_infl_04 dummy
scoreboard objectives add nexus.anim_infl_05 dummy
scoreboard objectives add nexus.anim_infl_06 dummy
scoreboard objectives add nexus.anim_infl_07 dummy
scoreboard objectives add nexus.anim_infl_08 dummy
scoreboard objectives add nexus.anim_infl_09 dummy
scoreboard objectives add nexus.anim_infl_10 dummy
scoreboard objectives add nexus.anim_infl_11 dummy
scoreboard objectives add nexus.anim_infl_12 dummy
scoreboard objectives add nexus.anim_infl_13 dummy
scoreboard objectives add nexus.anim_infl_14 dummy
scoreboard objectives add nexus.anim_infl_15 dummy
scoreboard objectives add nexus.anim_infl_16 dummy
scoreboard objectives add nexus.anim_infl_17 dummy
scoreboard objectives add nexus.anim_infl_18 dummy
scoreboard objectives add nexus.anim_infl_19 dummy







# Set constants

scoreboard players set #1 nexus.value 1
scoreboard players set #10 nexus.value 10
scoreboard players set #100 nexus.value 100
scoreboard players set #1000 nexus.value 1000
scoreboard players set #10000 nexus.value 10000
scoreboard players set #100000 nexus.value 100000
scoreboard players set #1000000 nexus.value 1000000
scoreboard players set #10000000 nexus.value 10000000
scoreboard players set #100000000 nexus.value 100000000
scoreboard players set #1000000000 nexus.value 1000000000

scoreboard players set #2 nexus.value 2
scoreboard players set #4 nexus.value 4
scoreboard players set #8 nexus.value 8
scoreboard players set #16 nexus.value 16
scoreboard players set #32 nexus.value 32
scoreboard players set #64 nexus.value 64
scoreboard players set #128 nexus.value 128
scoreboard players set #256 nexus.value 256
scoreboard players set #512 nexus.value 512
scoreboard players set #1024 nexus.value 1024
scoreboard players set #2048 nexus.value 2048
scoreboard players set #4096 nexus.value 4096
scoreboard players set #8192 nexus.value 8192
scoreboard players set #16384 nexus.value 16384
scoreboard players set #32768 nexus.value 32768
scoreboard players set #65536 nexus.value 65536
scoreboard players set #131072 nexus.value 131072
scoreboard players set #262144 nexus.value 262144
scoreboard players set #524288 nexus.value 524288
scoreboard players set #1048576 nexus.value 1048576
scoreboard players set #2097152 nexus.value 2097152
scoreboard players set #4194304 nexus.value 4194304
scoreboard players set #8388608 nexus.value 8388608
scoreboard players set #16777216 nexus.value 16777216
scoreboard players set #33554432 nexus.value 33554432
scoreboard players set #67108864 nexus.value 67108864
scoreboard players set #134217728 nexus.value 134217728
scoreboard players set #268435456 nexus.value 268435456
scoreboard players set #536870912 nexus.value 536870912
scoreboard players set #1073741824 nexus.value 1073741824
scoreboard players set #-2147483648 nexus.value -2147483648

scoreboard players set #-1 nexus.value -1
scoreboard players set #3 nexus.value 3
scoreboard players set #5 nexus.value 5
scoreboard players set #6 nexus.value 6
scoreboard players set #7 nexus.value 7
scoreboard players set #9 nexus.value 9
scoreboard players set #15 nexus.value 15
scoreboard players set #20 nexus.value 20
scoreboard players set #25 nexus.value 25
scoreboard players set #45 nexus.value 45
scoreboard players set #50 nexus.value 50
scoreboard players set #90 nexus.value 90
scoreboard players set #180 nexus.value 180
scoreboard players set #360 nexus.value 360
scoreboard players set #250 nexus.value 250
scoreboard players set #500 nexus.value 500
scoreboard players set #720 nexus.value 720
scoreboard players set #900 nexus.value 900
scoreboard players set #1570 nexus.value 1570
scoreboard players set #1800 nexus.value 1800
scoreboard players set #2000 nexus.value 2000
scoreboard players set #2500 nexus.value 2500
scoreboard players set #3141 nexus.value 3141
scoreboard players set #3600 nexus.value 3600
scoreboard players set #4000 nexus.value 4000
scoreboard players set #5040 nexus.value 5040
scoreboard players set #6283 nexus.value 6283

scoreboard players set #lcg_multiplier nexus.value 1664525
scoreboard players set #lcg_increment nexus.value 1013904223

function nexus:generic/rng/cbrng/initialize

# Hardcoded powers of e are e raised to 2 to the power of the listed value

scoreboard players set #e_power_00 nexus.value 1001
scoreboard players set #e_power_01 nexus.value 1002
scoreboard players set #e_power_02 nexus.value 1004
scoreboard players set #e_power_03 nexus.value 1008
scoreboard players set #e_power_04 nexus.value 1016
scoreboard players set #e_power_05 nexus.value 1032
scoreboard players set #e_power_06 nexus.value 1066
scoreboard players set #e_power_07 nexus.value 1136
scoreboard players set #e_power_08 nexus.value 1291
scoreboard players set #e_power_09 nexus.value 1668
scoreboard players set #e_power_10 nexus.value 2784
scoreboard players set #e_power_11 nexus.value 7752
scoreboard players set #e_power_12 nexus.value 60099

scoreboard players set #gravity nexus.value -125







# Add bossbars

bossbar add nexus:object_count [{"text":"Objects Remaining: ","color":"gray"},{"text":"0","color":"gold"}]
bossbar set nexus:object_count color white
bossbar set nexus:object_count max 1
bossbar set nexus:object_count value 0
bossbar set nexus:object_count style progress
bossbar set nexus:object_count visible true
bossbar set nexus:object_count players







# Set gamerules

gamerule maxCommandChainLength 2147483647







# Add teams

team add nexus.vehicle
team modify nexus.vehicle collisionRule never
team modify nexus.vehicle seeFriendlyInvisibles false

team add nexus.no_collision
team modify nexus.no_collision collisionRule never
team modify nexus.no_collision seeFriendlyInvisibles false







# Update last modified values

scoreboard players set #update_installation_boolean nexus.value 0

scoreboard players set #last_modified nexus.value 2023022363
execute unless score #doms_nexus_last_modified nexus.value = #last_modified nexus.value run scoreboard players set #update_installation_boolean nexus.value 1
scoreboard players operation #doms_nexus_last_modified nexus.value = #last_modified nexus.value
function #nexus:setup/last_modified







# Manage values and parameters

scoreboard players set #world_border_reset_timer nexus.value 0
scoreboard players set #doms_nexus_module_count nexus.value 0
scoreboard players set #feature_minimum_difficulty nexus.value 0
execute if score #update_installation_boolean nexus.value matches 1 run scoreboard players add #global nexus.modified 1
scoreboard players set #skip_world_border_tamper_notice nexus.value 1

execute unless score #debug_tick_time_display nexus.value = #debug_tick_time_display nexus.value run scoreboard players set #debug_tick_time_display nexus.value 0
execute unless score #debug_loaded_entity_display nexus.value = #debug_loaded_entity_display nexus.value run scoreboard players set #debug_loaded_entity_display nexus.value 0
execute unless score #debug_system_messages nexus.value = #debug_system_messages nexus.value run scoreboard players set #debug_system_messages nexus.value 1
execute unless score #debug_login_messages nexus.value = #debug_login_messages nexus.value run scoreboard players set #debug_login_messages nexus.value 1
execute unless score #debug_death_messages nexus.value = #debug_death_messages nexus.value run scoreboard players set #debug_death_messages nexus.value 1

scoreboard players add #death_messages_timer nexus.value 0

scoreboard players set #feature_time_manager nexus.value 0
scoreboard players set #feature_external_time_measurement nexus.value 0
scoreboard players set #feature_player_nbt nexus.value 0
scoreboard players set #feature_player_health nexus.value 0
scoreboard players set #feature_player_respawn nexus.value 0
scoreboard players set #feature_player_motion nexus.value 0
scoreboard players set #feature_entity_processing nexus.value 0
scoreboard players set #feature_entity_health nexus.value 0
scoreboard players set #feature_custom_entity_ticking nexus.value 0
scoreboard players set #feature_unconditional_entity_ticking nexus.value 0
scoreboard players set #feature_damage_sensor_ticking nexus.value 0
scoreboard players set #feature_vehicle nexus.value 0
scoreboard players set #feature_event_id_phe nexus.value 0
scoreboard players set #feature_event_id_pke nexus.value 0
scoreboard players set #feature_event_id_ehp nexus.value 0
scoreboard players set #feature_event_id_ekp nexus.value 0
scoreboard players set #feature_event_id_piwe nexus.value 0
scoreboard players set #feature_object_ticking nexus.value 0
scoreboard players set #feature_chunk_processing nexus.value 0
scoreboard players set #feature_chunk_activation nexus.value 0
scoreboard players set #feature_chunk_range nexus.value 0
scoreboard players set #feature_maximum_entity_time nexus.value 45
scoreboard players set #feature_maximum_object_time nexus.value 45
scoreboard players set #feature_maximum_chunk_time nexus.value 45
scoreboard players set #feature_minimum_entity_time nexus.value 5
scoreboard players set #feature_minimum_object_time nexus.value 5
scoreboard players set #feature_minimum_chunk_time nexus.value 3

function nexus:object/reset
function #nexus:setup/feature/initialize

scoreboard players set #input nexus.value 0
function nexus:generic/rng/predicate
scoreboard players operation #lcg nexus.value = #output nexus.value







# Tell that Nexus loaded properly

execute if score #debug_system_messages nexus.value matches 1 if score #update_installation_boolean nexus.value matches 1 run tellraw @a[tag=nexus.player.operator] ["",{"text":"[","color":"gray"},{"text":"Dom's Nexus","color":"blue"},{"text":"]","color":"gray"}," ",{"text":"Nexus and modules were successfully installed.","color":"gray"}]







# Set up modules

function #nexus:setup/main







# Adjust feature booleans for dependencies

execute if score #feature_player_health nexus.value matches 1 run scoreboard players set #feature_player_respawn nexus.value 1
execute if score #feature_player_motion nexus.value matches 1 run scoreboard players set #feature_player_respawn nexus.value 1
execute if score #feature_unconditional_entity_ticking nexus.value matches 1 run scoreboard players set #feature_custom_entity_ticking nexus.value 1
execute if score #feature_object_ticking nexus.value matches 1 run scoreboard players set #feature_time_manager nexus.value 1
execute if score #feature_chunk_activation nexus.value matches 1 run scoreboard players set #feature_chunk_processing nexus.value 1
execute if score #feature_chunk_processing nexus.value matches 1 run scoreboard players set #feature_time_manager nexus.value 1

function #nexus:setup/feature/dependency







# Set difficulty according to minimum difficulty

execute store result score #current_difficulty nexus.value run difficulty
execute if score #feature_minimum_difficulty nexus.value matches 0 if score #current_difficulty nexus.value < #feature_minimum_difficulty nexus.value run difficulty peaceful
execute if score #feature_minimum_difficulty nexus.value matches 1 if score #current_difficulty nexus.value < #feature_minimum_difficulty nexus.value run difficulty easy
execute if score #feature_minimum_difficulty nexus.value matches 2 if score #current_difficulty nexus.value < #feature_minimum_difficulty nexus.value run difficulty normal
execute if score #feature_minimum_difficulty nexus.value matches 3 if score #current_difficulty nexus.value < #feature_minimum_difficulty nexus.value run difficulty hard







# Verify that tick function tag loaded correctly

scoreboard players set #doms_nexus_ticking_function nexus.value 0
function #minecraft:tick

execute if score #doms_nexus_ticking_function nexus.value matches 0 run tellraw @a ["",{"text":"[","color":"gray"},{"text":"Dom's Nexus","color":"blue"},{"text":"]","color":"gray"}," ",{"text":"Error: ","color":"dark_red"},{"text":"Function tag ","color":"red"},{"text":"#minecraft:tick","color":"gold"},{"text":" didn't load properly. Disable the installed data pack that interferes with the function tag.","color":"red"}]
execute if score #doms_nexus_ticking_function nexus.value matches 1 run scoreboard players add #global nexus.ticks 1